/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : main.c
  * @brief          : Main program body
  ******************************************************************************
  * @attention
  *
  * Copyright (c) 2025 STMicroelectronics.
  * All rights reserved.
  *
  * This software is licensed under terms that can be found in the LICENSE file
  * in the root directory of this software component.
  * If no LICENSE file comes with this software, it is provided AS-IS.
  *
  ******************************************************************************
  */
/* USER CODE END Header */
/* Includes ------------------------------------------------------------------*/
#include "main.h"

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */
#include <stdio.h>
#include "stm32f4xx.h"
#include "lcd_stm32f4.h"
/* USER CODE END Includes */

/* Private typedef -----------------------------------------------------------*/
/* USER CODE BEGIN PTD */

/* USER CODE END PTD */

/* Private define ------------------------------------------------------------*/
/* USER CODE BEGIN PD */
// TODO: Add values for below variables
#define NS 1024        // Number of samples in LUT
#define TIM2CLK 16000000  // STM Clock frequency: Hint You might want to check the ioc file
#define F_SIGNAL 1 // Frequency of output analog signal

/* USER CODE END PD */

/* Private macro -------------------------------------------------------------*/
/* USER CODE BEGIN PM */

/* USER CODE END PM */                                                                                        c

/* Private variables ---------------------------------------------------------*/
TIM_HandleTypeDef htim2;
TIM_HandleTypeDef htim3;
DMA_HandleTypeDef hdma_tim2_ch1;


/* USER CODE BEGIN PV */
// TODO: Add code for global variables, including LUTs
uint32_t Sin_LUT[NS] = {2047, 2147, 2248, 2347, 2446, 2545, 2641, 2737, 2831, 2922, 3012, 3100, 3185, 3267, 3346, 3422, 3495, 3564, 3630, 3692, 3749, 3803, 3853, 3898, 3939, 3975, 4006, 4033, 4055, 4072, 4085, 4092, 4095, 4092, 4085, 4072, 4055, 4033, 4006, 3975, 3939, 3898, 3853, 3803, 3749, 3692, 3630, 3564, 3495, 3422, 3346, 3267, 3185, 3100, 3012, 2922, 2831, 2737, 2641, 2545, 2446, 2347, 2248, 2147, 2047, 1947, 1846, 1747, 1648, 1549, 1453, 1357, 1263, 1172, 1082, 994, 909, 827, 748, 672, 599, 530, 464, 402, 345, 291, 241, 196, 155, 119, 88, 61, 39, 22, 9, 2, 0, 2, 9, 22, 39, 61, 88, 119, 155, 196, 241, 291, 345, 402, 464, 530, 599, 672, 748, 827, 909, 994, 1082, 1172, 1263, 1357, 1453, 1549, 1648, 1747, 1846, 1947};
uint32_t Saw_LUT[NS] = {0, 31, 63, 95, 127, 159, 191, 223, 255, 287, 319, 351, 383, 415, 447, 479, 511, 543, 575, 607, 639, 671, 703, 735, 767, 799, 831, 863, 895, 927, 959, 991, 1023, 1055, 1087, 1119, 1151, 1183, 1215, 1247, 1279, 1311, 1343, 1375, 1407, 1439, 1471, 1503, 1535, 1567, 1599, 1631, 1663, 1695, 1727, 1759, 1791, 1823, 1855, 1887, 1919, 1951, 1983, 2015, 2047, 2079, 2111, 2143, 2175, 2207, 2239, 2271, 2303, 2335, 2367, 2399, 2431, 2463, 2495, 2527, 2559, 2591, 2623, 2655, 2687, 2719, 2751, 2783, 2815, 2847, 2879, 2911, 2943, 2975, 3007, 3039, 3071, 3103, 3135, 3167, 3199, 3231, 3263, 3295, 3327, 3359, 3391, 3423, 3455, 3487, 3519, 3551, 3583, 3615, 3647, 3679, 3711, 3743, 3775, 3807, 3839, 3871, 3903, 3935, 3967, 3999, 4031, 4063};
uint32_t Triangle_LUT[NS] = {0, 63, 127, 191, 255, 319, 383, 447, 511, 575, 639, 703, 767, 831, 895, 959, 1023, 1087, 1151, 1215, 1279, 1343, 1407, 1471, 1535, 1599, 1663, 1727, 1791, 1855, 1919, 1983, 2047, 2111, 2175, 2239, 2303, 2367, 2431, 2495, 2559, 2623, 2687, 2751, 2815, 2879, 2943, 3007, 3071, 3135, 3199, 3263, 3327, 3391, 3455, 3519, 3583, 3647, 3711, 3775, 3839, 3903, 3967, 4031, 4095, 4031, 3967, 3903, 3839, 3775, 3711, 3647, 3583, 3519, 3455, 3391, 3327, 3263, 3199, 3135, 3071, 3007, 2943, 2879, 2815, 2751, 2687, 2623, 2559, 2495, 2431, 2367, 2303, 2239, 2175, 2111, 2047, 1983, 1919, 1855, 1791, 1727, 1663, 1599, 1535, 1471, 1407, 1343, 1279, 1215, 1151, 1087, 1023, 959, 895, 831, 767, 703, 639, 575, 511, 447, 383, 319, 255, 191, 127, 63};
uint32_t Drum_LUT[] = {
  2047,   2048,   2042,   605,   36,   389,   4094,   3, 
  3430,   996,   2224,   2227,   2207,   2168,   1951,   1901,
  1891,   2227,   1512,   2479,   1690,   2072,   2285,   1805,
  2245,   1912,   2022,   2129,   1986,   2073,   2016,   2103,
  2024,   2050,   2088,   1878,   4095,   1346,   4095,   2,
  3342,   1499,   2094,   2106,   2493,   1847,   2110,   1831, 
  1867,   2387,   1426,   2448,   1725,   1984,   2290,   1839,
  2187,   1986,   1972,   2116,   2002,   2063,   2029,   2081,
  2038,   2040,   2077,   1417,   3034,   909,   966,   2667,
  2129,   1791,   1694,   1991,   2223,   2211,   1929,   1967,
  2086,   2134,   1983,   2063,   2037,   2049,   2050,   2009,
  2069,   2058,   2040,   2031,   2040,   2041,   2045,   2046,
  2044,   2053,   1855,   0,   254,   3636,   6,   3502,
  1008,   2042,   2196,   2271,   1880,   1982,   1976,   1747,
  2390,   1619,   2184,   2039,   1702,   2400,   1873,   2031,
  2261,   1861,   2062,   2107,   1903,   2063,   1979,   2113,
  1977,   2063,   1920,   1974,   2031,   1709,   1920,   2120,
  2024,   1980,   2079,   1977,   2111,   2080,   2035,   2068,
  2037,   2040,   2025,   2057,   2104,   2043,   2065,   2042,
  2036,   2062,   2039,   2048,   2045,   2039,   2047,   2050, 
  2044,   2053,   2020,   2664,   1524,   1750,   2000,   2177,
  2014,   2043,   2047,   2070,   2108,   2091,   2021,   2037,
  2049,   2040,   2136,   2122,   2056,   2083,   2054,   2033,
  2043,   2084,   2035,   2052,   2066,   2048,   2053,   2045,
  2049,   1977,   4093,   4078,   1448,   1430,   2261,   2716,
  1677,   1442,   2131,   2375,   2259,   1886,   1944,   2082,
  2090,   2002,   2038,   2064,   2028,   2038,   2046,   2036,
  2060,   2040,   2045,   2043,   2067,   2026,   2054,   2032,
  2069,   2027,   1956,   2340,   2323,   1851,   2033,   1993,
  1944,   2032,   2055,   2060,   2040,   2057,   2045,   2042,
  2048,   1967,   2976,   336,   2031,   2900,   1172,   3084, 
  1789,   2747,   1302,   2588,   1248,   2442,   2116,   1853,
  2062,   2154,   2437,   22,   925,   3648,   0,   2856,
  503,   1967,   2163,   1960,   2559,   1801,   2072,   2071,
  2068,   1746,   2419,   1698,   2195,   2185,   1813,   2282,
  1856,   2098,   2124,   1958,   2076,   1994,   2121,   1996,
  2063,   2079,   2256,   2129,   2120,   1931,   2090,   2066,
  2140,   1976,   2038,   2066,   2023,   2054,   2082,   2022,
  2062,   2052,   2058,   1999,   2044,   2059,   2025,   2104,
  2156,   2052,   2060,   2034,   2053,   2053,   2048,   2047,
  2049,   2032,   4095,   1362,   1526,   1627,   2425,   1876,
  1995,   2083,   2460,   2178,   1968,   1981,   2071,   2052,
  2034,   2000,   2078,   2055,   2040,   2060,   2040,   2053,
  2038,   2041,   2039,   2056,   2044,   2043,   2042,   2050,
  2030,   2077,   2714,   1680,   3194,   0,   2818,   0,
  1822,   2008,   2020,   2362,   1843,   2117,   1800,   2537,
  1540,   2461,   1928,   1837,   2526,   1801,   2088,   2068,
  1843,   2193,   1982,   2026,   2030,   2082,   2031,   2000,
  2087,   2016,   1836,   1694,   2307,   2162,   2274,   2075,
  2076,   2155,   1999,   2025,   2042,   2023,   2081,   2043,
  2064,   2074,   2057,   2050,   2065,   2051,   2047,   2033,
  2067,   2038,   2046,   2048,   2040,   2055,   2049,   2042,
  2052,   2040,   23,   2061,   1721,   2487,   2015,   3506,
  2287,   2307,   1209,   2704,   1447,   2705,   1930,   1868,
  2469,   1753,   2329,   2108,   1872,   2160,   2039,   2033,
  2137,   1956,   2057,   2100,   2026,   2060,   2005,   2076,
  2033,   896,   656,   1277,   3353,   2536,   1865,   2070,
  2329,   2310,   1853,   1905,   1963,   2119,   2142,   2037,
  2018,   2060,   2093,   2024,   2002,   2056,   2045,   2041, 
  2020,   2031,   2061,   2054,   2023,   2056,   2030,   2071,
  2041,   1770,   2376,   1822,   1952,   2213,   2207,   2088,
  2061,   1959,   1994,   2062,   2064,   2051,   2057,   2047,
  2043,   1069,   1566,   2001,   2646,   849,   3657,   2008,
  2415,   1678,   2254,   1730,   2469,   2043,  1789,   2258,
  1948,   1978,   4081,   2979,   2354,   2199,   2402,   1174,
  1850,   2192,   1640,   2475,   1485,   2270,   2163,   1993,
  2120,   2224,   1815,   2240,   1993,   1881,   2252,   1884,
  2152,   2082,   1960,   2098,   1982,   2114,   1980,   2079,
  2061,   1433,   2076,   2018,   3259,   313,   2612,   572,
  1822,   2152,   1872,   2564,   1711,   2137,   2122,   2036,
  1875,   2338,   1715,   2221,   2122,   1821,   2281,   1850,
  2115,   2113,   1955,   2082,   1993,   2125,   1984,   2073,
  2078,   321,   212,   3273,   2100,   1285,   2111,   2163,
  2244,   1761,   1668,   1899,   2152,   2098,   2007,   2027,
  2053,   2095,   1996,   1996,   2054,   2069,   2036,   2042,
  2058,   2051,   2059,   2049,   2053,   2040,   2047,   2042,
  2053,   4095,   2249,   2537,   2038,   2513,   1282,   2492,
  2099,   1610,   2376,   1492,   2604,   1978,   2383,   1788, 
  2531,   1923,   1999,   2331,   1596,   2290,   2046,   2098,
  2153,   2010,   2090,   2025,   2102,   2066,   2093,   1985,
  2101,   1833,   2359,   1966,   1870,   2013,   1975,   2122,
  2069,   2076,   2062,   2048,   2033,   2066,   2027,   2049,
  2020,   2053,   2028,   2046,   2040,   2046,   2020,   2040,
  2053,   2045,   2056,   2041,   2044,   2045,   2045,   2053,
  2043,   2635,   1906,   2004,   1840,   2174,   2079,   2073,
  2019,   2036,   2062,   2090,   2040,   2047,   2055,   2042,
  2049,   2047,   2022,   2040,   2053,   2071,   2039,   2037,
  2048,   2016,   2038,   2053,   2049,   2049,   2045,   2049,
  2011,   47,   3928,   3000,   1621,   2201,   2557,   2308,
  1911,   1714,   2087,   2191,   2055,   1994,   2038,   2100,
  2051,   2023,   2021,   2061,   2063,   2048,   2017,   2051,
  2041,   2066,   2056,   2036,   2056,   2021,   2061,   2037,
  2014,   2211,   1914,   1830,   2067,   2246,   2009,   2030,
  2036,   2111,   2039,   2031,   2044,   2054,   2042,   2051,
  1613,   4095,   758,   3683,   180,   4064,   1604,   1931,
  2263,   1770,   2302,   2291,   1995,   1814,   2445,   1723,
  2229,   1161,   609,   1892,   2126,   2579,   2968,   2374,
  2388,   1143,   2382,   1299,   2580,   2040,   1899,   2367,
  1976,   2113,   2229,   1886,   1996,   2159,   1955,   2174,
  2024,   1998,   2123,   1997,   2091,   1977,   2085,   2043,
  1953,   1880,   1908,   2076,   2016,   2066,   2115,   2017,
  2086,   2062,   2020,   2042,   2048,   2032,   2061,   2040,
  2082,   2077,   2022,   2053,   2065,   2111,   2071,   2073,
  2105,   2014,   2051,   2048,   2048,   2047,   2050,   2065,
  2540,   4095,   2191,   1090,   1382,   2239,   1640,   1673,
  1657,   2143,   2230,   2106,   2000,   2042,   2097,   2044,
  2041,   2059,   2056,   2031,   2074,   2051,   2025,   2065,
  2051,   2037,   2049,   2054,   2053,   2052,   2047,   2049,
  0,   466,   1450,   1928,   3179,   3613,   2726,   2302,
  961,   2451,   1234,   2712,   2170,   1936,   1940,   2280,
  1958,   2068,   2247,   1611,   2296,   1920,   2107,   2135,
  1902,   2093,   2079,   2113,   2027,   2052,   2012,   2038,
  1597,   2172,   2078,   1855,   1891,   2051,   1852,   1977,
  2019,   2035,   2057,   2069,   2049,   2036,   2036,   2006,
  2037,   2113,   2069,   2052,   2041,   2041,   2037,   2044,
  2041,   2049,   2044,   2044,   2046,   2043,   2049,   2040,
  1815,   2127,   719,   4093,   0,   3409,   1262,   2193,
  2189,   2347,   2017,   2018,   1871,   1868,   2311,   1420,
  2444,   1693,   2034,   2306,   1816,   2214,   1938,   2003,
  2131,   1997,   2073,   2022,   2092,   2030,   2052,   2035,
  4095,   3801,   1501,   1929,   2294,   2200,   1310,   1565,
  2371,   2337,   2082,   1932,   1981,   2116,   2092,   2009,
  2040,   2085,   2031,   1969,   2050,   2049,   2091,   2041,
  2050,   2061,   2054,   2061,   2029,   2055,   2050,   2499,
  1664,   2370,   1708,   2092,   1855,   2012,   2087,   2068,
  2028,   2048,   2061,   2057,   2036,   2042,   2050,   2345,
  3067,   463,   4095,   0,   3883,   1075,   2129,   2558,
  1202,   2781,   1827,   1965,   1954,   2401,   1668,   2050,
  2047
};

uint32_t Piano_LUT[] = {
  1901,   1901,   1332,   1737,   979,   2358,   2625,   1554, 
  2180,   2075,   1686,   1994,   1865,   1812,   1849,   1636,
  1937,   2051,   1863,   1945,   1971,   1887,   1898,   1880,
  1899,   1916,   1868,   1917,   1934,   1881,   1902,   1918,
  1859,   1897,   1967,   1843,   1890,   1816,   1880,   1991,
  1873,   1912,   1905,   1873,   1914,   1908,   1911,   1896,
  1872,   1872,   1961,   1662,   2089,   2057,   1794,   1824,
  1861,   1824,   2067,   1791,   1951,   1779,   1939,   2009,
  1767,   1965,   1932,   1950,   1822,   1630,   1768,   1991,
  2211,   1879,   1844,   1964,   1783,   1957,   1934,   1824, 
  1861,   1826,   1876,   1896,   2140,   1627,   2179,   1654,
  2026,   1869,   1851,   2778,   1532,   1823,   1824,   1633,
  2048,   2102,   2196,   1284,   1620,   2082,   2023,   2080,
  1796,   1755,   1784,   1957,   1955,   1803,   1934,   1954,
  1866,   1909,   2253,   2150,   1435,   2144,   1733,   2117,
  1784,   2013,   1858,   1941,   1671,   1808,   2081,   1924,
  2020,   1700,   1829,   2009,   1983,   1950,   1854,   1824,
  1971,   1892,   1906,   1927,   1879,   1925,   1940,   1893,
  1884,   1892,   1769,   1864,   2096,   1866,   1949,   1786,
  1941,   1885,   1913,   1928,   1872,   1903,   1885,   1925,
  1877,   1897,   1912,   1888,   1904,   1885,   1915,   1896,
  1882,   1905,   1914,   1886,   1880,   1902,   1917,   1916,
  1903,   1867,   2135,   1786,   1977,   1912,   1797,   2026,
  1772,   2044,   1906,   1882,   1902,   1924,   1881,   1903,
  1892,   1886,   1923,   1709,   1591,   1714,   2630,   1594,
  2040,   1662,   1895,   2059,   1906,   1901,   1858,   1931,
  1907,   1906,   944,   2147,   1801,   1843,   2236,   1544,
  2006,   1817,   2102,   1731,   1960,   1877,   1921,   1908,
  1829,   1938,   2758,   1913,   2078,   1717,   1742,   1723,
  1844,   2404,   2103,   1753,   1764,   1962,   1928,   1735,
  1870,   912,   2687,   1952,   2165,   1649,   2004,   1758,
  1835,   1910,   2020,   1932,   1868,   1902,   1898,   1823,
  1848,   1186,   974,   3307,   2032,   1542,   2354,   1657,
  1835,   2009,   1753,   2025,   1785,   1659,   2111,   1951,
  1930,   2049,   1737,   1905,   1932,   1897,   1939,   1876,
  1861,   1959,   1874,   1925,   1929,   1890,   1876,   1951,
  1861,   1937,   1871,   1660,   2015,   2000,   1844,   1953,
  1921,   1876,   1904,   1909,   1908,   1888,   1843,   1924,
  1934,   2046,   1573,   927,   2304,   2255,   2129,   1744,
  1894,   2052,   1843,   1860,   2037,   1774,   1812,   1773,
  2051,   1652,   1718,   1733,   1322,   2265,   2408,   1618,
  1951,   2054,   1754,   1956,   1893,   1810,   1894,   1772,
  1929,   2371,   1572,   2000,   1827,   1711,   2154,   1783,
  2050,   1776,   1942,   2568,   1506,   1409,   1960,   1969,
  1868,   1661,   1887,   1778,   1955,   1942,   1748,   1831,
  1950,   2151,   1815,   1837,   1817,   1863,   2010,   1929,
  1971,   2334,   1549,   2354,   1443,   2213,   1908,   1749,
  1878,   1988,   1926,   2016,   1698,   1806,   2145,   1764, 
  2031,   1780,   1946,   1999,   1815,   1900,   1792,   1961,
  1943,   1928,   1816,   1899,   1903,   1874,   1923,   1889,
  1890,   1934,   1896,   1716,   2132,   1761,   1969,   1811,
  1931,   1891,   1891,   1908,   1883,   1914,   1885,   1891,
  1893,   1943,   1891,   1898,   1887,   1904,   1902,   1896,
  1905,   1884,   1890,   1880,   1917,   1890,   1905,   1899,
  1915,   2558,   1437,   2693,   827,   2368,   1951,   2190,
  1689,   1672,   1820,   2246,   1890,   1853,   1750,   1847,
  2064,   1916,   2706,   1515,   1411,   2072,   1880,   2175,
  1774,   1797,   2044,   1816,   1862,   1850,   1884,   2001,
  1862,   2288,   1660,   2029,   1910,   1773,   2039,   1650,
  2199,   1865,   1940,   1818,   1904,   1919,   1927,   1919,
  1833,   2796,   840,   1741,   1717,   2526,   2226,   1444,
  1853,   1692,   2016,   2017,   1832,   2006,   1675,   1913,
  1977,   1576,   2336,   1457,   2078,   1886,   1894,   1978,
  1745,   1890,   1951,   1965,   1864,   1887,   1950,   1874,
  1887,   3435,   1617,   2402,   2143,   1394,   2175,   1712,
  1803,   1939,   1487,   1844,   2238,   1930,   1978,   1938,
  1894,   2067,   1759,   1915,   1891,   1874,   1756,   1993,
  1913,   1889,   1929,   1916,   1939,   1860,   1898,   1894,
  1924,   1784,   2116,   1908,   1846,   1970,   1836,   1934,
  1886,   1894,   1914,   1834,   1867,   1966,   1902,   1862,
  1945,   1728,   2344,   1835,   1874,   1651,   1956,   1979,
  2051,   1793,   1840,   1880,   1943,   2035,   1789,   1878,
  1878,   1110,   1303,   2758,   2074,   1833,   2245,   1891,
  1819,   2015,   1641,   1889,   1861,   1568,   2057,   2027,
  1881,   2167,   1775,   1999,   1908,   1884,   1856,   1825,
  1981,   1950,   1794,   2261,   2837,   1236,   1809,   1532,
  1845,   2611,   2345,   2195,   1342,   1573,   1994,   2104,
  2152,   1806,   1953,   1790,   1885,   1936,   1813,   1935,
  1951,   2252,   1811,   1806,   2145,   1566,   2361,   1313,
  2230,   1905,   2060,   1892,   1710,   1798,   2116,   1883,
  1977,   1779,   1805,   1925,   1929,   1944,   1861,   1834,
  1883,   1944,   1868,   1936,   1886,   1912,   1884,   1903,
  1900,   1821,   1896,   1885,   2002,   1868,   1858,   1905,
  1853,   1930,   1911,   1908,   1880,   1921,   1885,   1899,
  1907,   1944,   1891,   1889,   1910,   1886,   1882,   1903,
  1903,   1898,   1942,   1870,   1878,   1900,   1911,   1893,
  1914,   2144,   1629,   2110,   1744,   2002,   1853,   1888,
  1950,   1882,   1914,   1890,   1902,   1886,   1901,   1900,
  1886,   2687,   1926,   2036,   1348,   1837,   2222,   1994,
  1668,   2020,   1807,   2083,   1818,   1840,   1925,   2006,
  1864,   2406,   1864,   1728,   1914,   1817,   1970,   1807,
  2199,   1783,   2115,   1672,   1797,   2096,   1899,   1993,
  1748,   935,   1851,   1909,   2300,   2276,   1473,   1789,
  1988,   2050,   1771,   1519,   2071,   2024,   2025,   1796,
  1845,   1987,   1818,   2005,   1100,   2476,   1748,   2070,
  1782,   1901,   2034,   1581,   1876,   1979,   1931,   1948,
  1924,   2589,   1322,   1973,   2240,   1448,   2295,   1868,
  1320,   2007,   2142,   1885,   1881,   1984,   1788,   1880,
  1917,   1974,   1867,   1828,   1874,   1802,   1994,   1871,
  1923,   1920,   1907,   1906,   1878,   1863,   1913,   1926,
  1881,   1812,   1978,   1867,   1851,   2012,   1895,   1903,
  1864,   1848,   1905,   1929,   1905,   1915,   1913,   1893,
  1890,   2276,   2416,   1927,   1863,   2161,   1673,   2095,
  1823,   1618,   1795,   1889,   2060,   1972,   1925,   1930,
  1867,   3074,   1817,   2072,   2272,   1756,   2056,   1828, 
  1747,   1971,   1564,   1788,   2179,   1976,   1890,   1978,
  1585,   2252,   1705,   2112,   1774,   1986,   1754,   1944,
  2024,   1878,   1989,   2245,   1937,   2141,   1526,   1972,
  1973,   1465,   1796,   2021,   2222,   2097,   1737,   1639,
  1720,   2010,   2025,   1900,   1729,   1843,   1924,   1911,
  1856,   1745,   1987,   1446,   2462,   1503,   2438,   1343,
  1936,   2055,   1969,   1951,   1690,   1872,   1999,   1909,
  1813,   1842,   1850,   2061,   1857,   1828,   1906,   1901,
  1928,   1908,   1923,   1842,   1900,   1890,   1934,   1910,
  1954,   1859,   1814,   1909,   1913,   1921,   1850,   1973,
  1863,   1902,   1918,   1901,   1884,   1932,   1871,   1921,
  1861,   1925,   1896,   1880,   1893,   1920,   1904,   1898,
  1910,   1890,   1908,   1913,   1869,   1897,   1907,   1905,
  1529,   2914,   1446,   2185,   1393,   1867,   2464,   1532,
  2237,   1532,   1879,   2079,   1926,   1923,   1802,   1880,
  2634,   1418,   1979,   2408,   1600,   2153,   1536,   1786,
  2225,   1900,   2071,   1653,   1762,   2053,   1997,   2021,
  1960,   1862,   1838,   2087,   1778,   2024,   1729,   1931,
  1929,   1934,   1892,   1861,   1901,   1943,   1886,   1892,
  1963,   2004,   1462,   1824,   2000,   1952,   2257,   1722,
  2010,   1883,   1833,   1962,   1822,   2101,   1853,   1792,
  1515,   2305,   1569,   2316,   1492,   2162,   1674,   2116,
  1684,   1751,   2010,   2169,   2002,   1701,   1662,   1897,
  1901
};

uint32_t Guitar_LUT[] = {
  1970,   1970,   1970,   1998,   2224,   2111,   2102,   2192, 
  1849,   1575,   1504,   1982,   2328,   2327,   2122,   1937,
  1892,   2070,   2137,   2060,   1798,   1585,   1664,   1982,
  2203,   2149,   1970,   1898,   2004,   2186,   2184,   2035,
  1761,   1633,   1767,   2011,   2129,   2013,   1923,   2116,
  2107,   2078,   2333,   2033,   1901,   1795,   1692,   2193,
  2122,   2128,   1896,   1808,   2012,   2446,   1401,   1431,
  3234,   727,   2669,   1243,   2882,   1716,   1868,   2276,
  2000,   2501,   1689,   1856,   1895,   2020,   2238,   1872,
  1934,   1916,   1961,   1989,   1945,   2006,   1887,   2029,
  1960,   2025,   1948,   1935,   1947,   1959,   1994,   1984,
  1998,   1964,   1972,   1957,   2012,   1938,   1989,   1940,
  1966,   1987,   1952,   2024,   1921,   1698,   2210,   1946,
  1834,   2164,   1883,   2081,   1820,   1862,   2036,   1920,
  2103,   1880,   1938,   2075,   1932,   1994,   1957,   1957,
  1995,   1946,   1996,   1965,   1964,   1978,   1955,   1979,
  1965,   1977,   1964,   2770,   2383,   1913,   1734,   1524,
  1382,   1714,   2547,   2366,   1933,   1814,   1757,   1566,
  1903,   2473,   2203,   1863,   1732,   1781,   1727,   2077,
  2505,   2205,   1896,   1709,   1661,   1738,   2127,   2389,
  2106,   1886,   1807,   1707,   1813,   2283,   2206,   1991,
  1942,   1768,   1585,   2026,   2315,   2116,   2109,   1877,
  1608,   1684,   2031,   2468,   2258,   970,   2398,   2072,
  1634,   1986,   1560,   1931,   2080,   2128,   1524,   1611,
  2224,   2262,   1929,   1820,   1912,   2124,   1956,   2109,
  1987,   1921,   1936,   1937,   2010,   2010,   2031,   1922,
  1955,   1963,   1946,   1959,   1971,   1981,   1965,   1973,
  1975,   1962,   1985,   1985,   2005,   1965,   1965,   1961,
  1954,   1975,   1986,   1968,   1886,   1925,   2143,   2310,
  1844,   1793,   2062,   1861,   1916,   1973,   2028,   1953,
  1899,   2157,   1837,   2019,   2008,   1966,   1949,   1992,
  2025,   1954,   1957,   1977,   1978,   1961,   1959,   1969,
  1972,   1965,   1968,   1967,   2284,   1965,   1728,   2197,
  1955,   2053,   2122,   1824,   2111,   1887,   2079,   2049,
  1800,   2177,   1875,   2054,   1999,   1848,   2098,   1862,
  2100,   1951,   1867,   2084,   1835,   2101,   1945,   1940, 
  2040,   1839,   2091,   1951,   2175,   2055,   1914,   2093,
  2076,   2122,   1912,   1949,   1991,   2033,   2062,   2016,
  2029,   1962,   1860,   2155,   2317,   3895,   1561,   1555,
  1908,   2050,   2303,   2235,   1184,   1815,   2028,   2267,
  1848,   1651,   1874,   1842,   2037,   1962,   2030,   2000,
  2029,   1980,   1970,   1919,   2033,   1967,   1976,   1976,
  1938,   1986,   1947,   1970,   2001,   1941,   1967,   1957,
  1976,   1989,   1955,   1986,   1975,   1970,   1979,   1951,
  1992,   1953,   2000,   1963,   1976,   2010,   1853,   1914,
  1939,   1888,   1919,   1915,   1994,   2105,   1942,   1837,
  1796,   2001,   2060,   2027,   2071,   1907,   1797,   1859,
  2033,   2033,   1992,   1980,   1954,   1961,   1978,   1978,
  1983,   1968,   1952,   1946,   1937,   1856,   2155,   1996,
  2015,   1916,   1751,   2224,   1900,   2007,   2075,   1784,
  2138,   1892,   2058,   2035,   1805,   2115,   1896,   2043,
  1968,   1858,   2065,   1878,   2097,   1952,   1918,   2035,
  1850,   2102,   1920,   1739,   1701,   1875,   2076,   1643,
  2126,   2240,   1717,   2060,   1762,   2067,   1965,   1785,
  2228,   2142,   1926,   1952,   1967,   2448,   1802,   1908,
  2232,   1630,   1509,   1958,   2182,   1541,   2100,   1764,
  2288,   1905,   2027,   2566,   1707,   1734,   1904,   1671,
  1674,   2283,   2381,   1849,   1677,   1651,   1693,   1911,
  2515,   2477,   2021,   1844,   1667,   1602,   1897,   2373,
  2242,   1880,   1884,   1781,   1778,   2120,   2378,   2151,
  1729,   1734,   1710,   1776,   2080,   2427,   2019,   1708,
  2202,   1833,   1624,   2304,   2473,   1824,   1630,   1925,
  1708,   1760,   2556,   2303,   2170,   2048,   2159,   1375,
  1885,   2111,   1827,   2060,   2144,   1789,   1865,   1974,
  2122,   1900,   2330,   1707,   1691,   2239,   2421,   2317,
  2037,   1865,   1895,   2070,   2036,   1892,   1609,   1506,
  1745,   2105,   2295,   2150,   1949,   1875,   2066,   2197,
  2110,   1929,   1632,   1619,   1872,   2121,   2107,   1977,
  1899,   1922,   2151,   2259,   2129,   1879,   1743,   1757,
  1887,   2228,   2120,   1896,   1984,   1966,   2333,   2245,
  2006,   1806,   1575,   1947,   2349,   2663,   1990,   2228,
  1873,   1570,   1607,   2298,   1435,   2179,   2084,   2127,
  1778,   1788,   1825,   1751,   1897,   2093,   1976,   1968,
  1934,   1968,   2018,   2001,   1952,   1932,   1979,   1979,
  1968,   1982,   1972,   1941,   1936,   1998,   2023,   1993,
  1958,   1956,   1928,   1975,   1980,   1989,   1966,   1951,
  1985,   1965,   2022,   1900,   2282,   1656,   1877,   1969,
  1724,   2247,   1915,   1913,   1952,   1763,   2129,   1864,
  2090,   1986,   1786,   2033,   1941,   1974,   1985,   1948,
  1990,   1950,   1970,   1977,   1951,   1988,   1963,   1975,
  1966,   1967,   1788,   1687,   1728,   2242,   2388,   2187,
  2047,   1918,   1667,   1707,   2260,   2375,   2108,   1787,
  1761,   1734,   1790,   2333,   2396,   2077,   1800,   1687,
  1709,   1848,   2256,   2264,   1977,   1853,   1794,   1777,
  2012,   2302,   2173,   1953,   1777,   1509,   1871,   2034,
  2142,   2148,   1928,   1633,   1726,   1809,   2061,   2202,
  2274,   1889,   1763,   2159,   1920,   3019,   1253,   2055,
  1483,   2453,   1738,   2117,   1811,   2334,   2449,   1575, 
  2217,   1322,   2204,   2102,   1997,   2052,   1894,   1920,
  1961,   2046,   2003,   1962,   1925,   1898,   1956,   1993,
  1999,   1939,   1982,   1957,   1968,   1967,   1961,   1953,
  1986,   1954,   1971,   1933,   1954,   1987,   1975,   1972,
  1956,   1960,   1953,   2036,   2109,   1869,   1611,   2198,
  1829,   1999,   1759,   2035,   1861,   2032,   2204,   1938,
  1875,   2048,   1889,   1954,   2095,   2008,   1951,   1846,
  2035,   1952,   1960,   1967,   1978,   1975,   1959,   1973,
  1972,   1959,   1968,   1746,   1632,   2194,   2057,   2047,
  1785,   1669,   2216,   1875,   2091,   2050,   1717,   2106,
  1851,   2133,   2003,   1795,   2068,   1837,   2120,   1925,
  1893,   2050,   1779,   2128,   1926,   1961,   2032,   1818,
  2094,   1907,   2053,   2036,   1853,   2237,   1692,   2104,
  1781,   1958,   2169,   1775,   2113,   1871,   1975,   1931,
  1804,   2186,   1843,   1954,   1669,   1666,   3446,   1285,
  1654,   2165,   1272,   2684,   1974,   1998,   1903,   1545,
  2192,   2457,   1959,   1900,   1930,   2050,   1906,   2001,
  1958,   1946,   1996,   1935,   1973,   1954,   1942,   2002,
  1971,   1963,   1970,   1963,   1976,   1993,   1987,   1974,
  1972,   1982,   1947,   1986,   1971,   1978,   1975,   1946,
  1989,   1968,   1977,   1983,   1920,   1968,   2017,   1990,
  2037,   2118,   1963,   1845,   1932,   2045,   1988,   2128,
  2050,   1903,   1821,   1903,   2081,   2033,   2054,   2018,
  1906,   1919,   1964,   1988,   1983,   1963,   1957,   1961,
  1972,   1984,   1993,   2298,   2285,   1607,   2008,   2044,
  1742,   2236,   1899,   2067,   1987,   1711,   2223,   1938,
  2128,   2013,   1786,   2074,   1872,   2122,   1957,   1895, 
  2004,   1825,   2128,   1901,   1992,   2045,   1817,   2108,
  1916,   2044,   2246,   1790,   1803,   1855,   1820,   2168,
  1600,   2140,   2225,   2032,   1913,   1980,   1889,   1947,
  1904,   2040,   2148,   1742,   1795,   2671,   1729,   1301,
  2298,   2464,   2222,   1893,   2268,   1864,   1531,   2259,
  1962,   1898,   1733,   1863,   2312,   2577,   2429,   1928,
  1849,   1537,   1524,   2067,   2471,   2326,   1945,   1925,
  1664,   1640,   2068,   2366,   2029,   1776,   1794,   1676,
  1834,   2266,   2494,   2123,   1696,   1739,   1651,   1814,
  2222,   2330,   2066,   1797,   1742,   1749,   1906,   2077,
  2411,   2066,   1588,   1796,   1923,   1802,   2221,   2432,
  1860,   1641,   1975,   1966,   1529,   1798,   2148,   1746,
  1625,   2184,   2008,   1797,   1944,   1935,   1995,   1793,
  2044,   1970
};
///hhj
// TODO: Equation to calculate TIM2_Ticks
uint32_t TIM2_Ticks = (TIM2CLK / (NS * F_SIGNAL))  ; // How often to write new LUT value
uint32_t DestAddress = (uint32_t) &(TIM3->CCR3); // Write LUT TO TIM3->CCR3 to modify PWM duty cycle


/* USER CODE END PV */

/* Private function prototypes -----------------------------------------------*/
void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_DMA_Init(void);
static void MX_TIM2_Init(void);
static void MX_TIM3_Init(void);
/* USER CODE BEGIN PFP */
void EXTI0_IRQHandler(void);
/* USER CODE END PFP */

/* Private user code ---------------------------------------------------------*/
/* USER CODE BEGIN 0 */

/* USER CODE END 0 */

/**
  * @brief  The application entry point.
  * @retval int
  */
int main(void)
{

  /* USER CODE BEGIN 1 */

  /* USER CODE END 1 */

  /* MCU Configuration--------------------------------------------------------*/

  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */
  HAL_Init();

  /* USER CODE BEGIN Init */

  /* USER CODE END Init */

  /* Configure the system clock */
  SystemClock_Config();

  /* USER CODE BEGIN SysInit */

  /* USER CODE END SysInit */

  /* Initialize all configured peripherals */
  MX_GPIO_Init();
  MX_DMA_Init();
  MX_TIM2_Init();
  MX_TIM3_Init();

  /* USER CODE BEGIN 2 */
 
  // TODO: Start TIM3 in PWM mode on channel 3
  HAL_TIM_PWM_Start(&htim3, TIM_CHANNEL_3);
  // TODO: Start TIM2 in Output Compare (OC) mode on channel 1
  HAL_TIM_OC_Start(&htim2,TIM_CHANNEL_1);
  // TODO: Start DMA in IT mode on TIM2->CH1. Source is LUT and Dest is TIM3->CCR3; start with Sine LUT
 HAL_DMA_Start_IT(&hdma_tim2_ch1, (uint32_t)Sin_LUT, DestAddress , NS);

  // TODO: Write current waveform to LCD(Sine is the first waveform)
 init_LCD();
  lcd_command(CLEAR);
  lcd_command(CURSOR_HOME);
  lcd_putstring("Waveform: ");
  lcd_command(LINE_TWO);
  lcd_putstring("Sine");

  // TODO: Enable DMA (start transfer from LUT to CCR)

__HAL_TIM_ENABLE_DMA(&htim2, TIM_DMA_CC1);

  /* USER CODE END 2 */

  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {
    /* USER CODE END WHILE */

    /* USER CODE BEGIN 3 */
  }
  /* USER CODE END 3 */
}

/**
  * @brief System Clock Configuration
  * @retval None
  */
void SystemClock_Config(void)
{
  RCC_OscInitTypeDef RCC_OscInitStruct = {0};
  RCC_ClkInitTypeDef RCC_ClkInitStruct = {0};

  /** Configure the main internal regulator output voltage
  */
  __HAL_RCC_PWR_CLK_ENABLE();
  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE3);

  /** Initializes the RCC Oscillators according to the specified parameters
  * in the RCC_OscInitTypeDef structure.
  */
  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;
  RCC_OscInitStruct.HSIState = RCC_HSI_ON;
  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;
  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;
  if (HAL_RCC_OscConfig(&RCC_OscInitStruct) != HAL_OK)
  {
    Error_Handler();
  }

  /** Initializes the CPU, AHB and APB buses clocks
  */
  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK
                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;
  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;
  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;
  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;
  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;

  if (HAL_RCC_ClockConfig(&RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)
  {
    Error_Handler();
  }
}

/**
  * @brief TIM2 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM2_Init(void)
{

  /* USER CODE BEGIN TIM2_Init 0 */

  /* USER CODE END TIM2_Init 0 */

  TIM_ClockConfigTypeDef sClockSourceConfig = {0};
  TIM_MasterConfigTypeDef sMasterConfig = {0};
  TIM_OC_InitTypeDef sConfigOC = {0};

  /* USER CODE BEGIN TIM2_Init 1 */

  /* USER CODE END TIM2_Init 1 */
  htim2.Instance = TIM2;
  htim2.Init.Prescaler = 0;                    
  htim2.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim2.Init.Period = TIM2_Ticks-1;  
  htim2.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim2.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_Base_Init(&htim2) != HAL_OK)
  {
    Error_Handler();
  }
  sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL;
  if (HAL_TIM_ConfigClockSource(&htim2, &sClockSourceConfig) != HAL_OK)
  {
    Error_Handler();
  }
  if (HAL_TIM_OC_Init(&htim2) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim2, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  sConfigOC.OCMode = TIM_OCMODE_TIMING;

  sConfigOC.Pulse = 0;
  sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;
  sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;
  if (HAL_TIM_OC_ConfigChannel(&htim2, &sConfigOC, TIM_CHANNEL_1) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM2_Init 2 */
  /* TIM2_CH1 DMA Init */
  __HAL_RCC_DMA1_CLK_ENABLE();

  hdma_tim2_ch1.Instance = DMA1_Stream5;
  hdma_tim2_ch1.Init.Channel = DMA_CHANNEL_3;         // TIM2_CH1 is on channel 3
  hdma_tim2_ch1.Init.Direction = DMA_MEMORY_TO_PERIPH; // Memory -> TIM3->CCR3
  hdma_tim2_ch1.Init.PeriphInc = DMA_PINC_DISABLE;    // Peripheral address fixed
  hdma_tim2_ch1.Init.MemInc = DMA_MINC_ENABLE;        // Memory address increments
  hdma_tim2_ch1.Init.PeriphDataAlignment = DMA_PDATAALIGN_WORD;
  hdma_tim2_ch1.Init.MemDataAlignment = DMA_MDATAALIGN_WORD;
  hdma_tim2_ch1.Init.Mode = DMA_CIRCULAR;            // Repeat LUT automatically
  hdma_tim2_ch1.Init.Priority = DMA_PRIORITY_HIGH;
  hdma_tim2_ch1.Init.FIFOMode = DMA_FIFOMODE_DISABLE;

  if (HAL_DMA_Init(&hdma_tim2_ch1) != HAL_OK)
  {
      Error_Handler();
  }

  /* Link DMA handle to TIM2 handle */
  __HAL_LINKDMA(&htim2, hdma[TIM_DMA_ID_CC1], hdma_tim2_ch1);
  /* USER CODE END TIM2_Init 2 */

}

/**
  * @brief TIM3 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM3_Init(void)
{

  /* USER CODE BEGIN TIM3_Init 0 */

  /* USER CODE END TIM3_Init 0 */

  TIM_ClockConfigTypeDef sClockSourceConfig = {0};
  TIM_MasterConfigTypeDef sMasterConfig = {0};
  TIM_OC_InitTypeDef sConfigOC = {0};

  /* USER CODE BEGIN TIM3_Init 1 */

  /* USER CODE END TIM3_Init 1 */
  htim3.Instance = TIM3;
  htim3.Init.Prescaler = 0;
  htim3.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim3.Init.Period = 4095;
  htim3.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim3.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_Base_Init(&htim3) != HAL_OK)
  {
    Error_Handler();
  }
  sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL;
  if (HAL_TIM_ConfigClockSource(&htim3, &sClockSourceConfig) != HAL_OK)
  {
    Error_Handler();
  }
  if (HAL_TIM_PWM_Init(&htim3) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim3, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  sConfigOC.OCMode = TIM_OCMODE_PWM1;
  sConfigOC.Pulse = 0;
  sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;
  sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;
  if (HAL_TIM_PWM_ConfigChannel(&htim3, &sConfigOC, TIM_CHANNEL_3) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM3_Init 2 */

  /* USER CODE END TIM3_Init 2 */
  HAL_TIM_MspPostInit(&htim3);

}

/**
  * Enable DMA controller clock
  */
static void MX_DMA_Init(void)
{

  /* DMA controller clock enable */
  __HAL_RCC_DMA1_CLK_ENABLE();

  /* DMA interrupt init */
  /* DMA1_Stream5_IRQn interrupt configuration */
  HAL_NVIC_SetPriority(DMA1_Stream5_IRQn, 0, 0);
  HAL_NVIC_EnableIRQ(DMA1_Stream5_IRQn);

}

/**
  * @brief GPIO Initialization Function
  * @param None
  * @retval None
  */
static void MX_GPIO_Init(void)
{
  GPIO_InitTypeDef GPIO_InitStruct = {0};
  /* USER CODE BEGIN MX_GPIO_Init_1 */

  /* USER CODE END MX_GPIO_Init_1 */

  /* GPIO Ports Clock Enable */
  __HAL_RCC_GPIOH_CLK_ENABLE();
  __HAL_RCC_GPIOA_CLK_ENABLE();
  __HAL_RCC_GPIOB_CLK_ENABLE();

  // -------------------------------
  // LCD pins configuration
  // -------------------------------
  // Configure PC14 (RS) and PC15 (E) as output push-pull
  GPIO_InitStruct.Pin = GPIO_PIN_14 | GPIO_PIN_15;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOC, &GPIO_InitStruct);

  // Configure PB8 (D4) and PB9 (D5) as output push-pull
  GPIO_InitStruct.Pin = GPIO_PIN_8 | GPIO_PIN_9;
  HAL_GPIO_Init(GPIOB, &GPIO_InitStruct);

  // Configure PA12 (D6) and PA15 (D7) as output push-pull
  GPIO_InitStruct.Pin = GPIO_PIN_12 | GPIO_PIN_15;
  HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);

  // Set all LCD pins LOW initially
  HAL_GPIO_WritePin(GPIOC, GPIO_PIN_14 | GPIO_PIN_15, GPIO_PIN_RESET);
  HAL_GPIO_WritePin(GPIOB, GPIO_PIN_8 | GPIO_PIN_9, GPIO_PIN_RESET);
  HAL_GPIO_WritePin(GPIOA, GPIO_PIN_12 | GPIO_PIN_15, GPIO_PIN_RESET);


  // -------------------------------
  // Button0 configuration (PA0)
  // -------------------------------
  GPIO_InitStruct.Pin = Button0_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING; // Interrupt on rising edge
  GPIO_InitStruct.Pull = GPIO_PULLUP;         // Use pull-up resistor
  HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);

  // Enable and set EXTI line 0 interrupt priority
  HAL_NVIC_SetPriority(EXTI0_IRQn, 2, 0);
  HAL_NVIC_EnableIRQ(EXTI0_IRQn);

  /* USER CODE END MX_GPIO_Init_2 */
}
volatile uint32_t lastDebounceTick = 0;
#define DEBOUNCE_DELAY 200  // ms
//extern uint32_t Sin_LUT[NS];

// Add other LUTs here
typedef enum {
    WAVE_SINE = 0,
    WAVE_SAW,
    WAVE_TRIANGLE,
    WAVE_PIANO,
    WAVE_DRUM,
    WAVE_GUITAR,
    WAVE_COUNT
} WaveformType;

volatile WaveformType currentWave = WAVE_SINE;
// enum to track which waveform is active
uint32_t* waveforms[WAVE_COUNT] = {
    Sin_LUT,     // WAVE_SINE
    Saw_LUT,     // WAVE_SAW
    Triangle_LUT, // WAVE_TRIANGLE
    Piano_LUT,   // WAVE_PIANO
    Drum_LUT,  // WAVE_GUITAR
    Guitar_LUT     // WAVE_DRUM
};
//A table of pointers for the wave forms
const char* waveNames[WAVE_COUNT] = {
    "Sine", "Sawtooth", "Triangle", "Piano", "Drum", "Guitar"
};


/* USER CODE BEGIN 4 */
void EXTI0_IRQHandler(void){

	// TODO: Debounce using HAL_GetTick()
	// TODO: Disable DMA transfer and abort IT, then start DMA in IT mode with new LUT and re-enable transfer
	// HINT: Consider using C's "switch" function to handle LUT changes
HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_0); // Clear interrupt

    uint32_t tick = HAL_GetTick();
    if ((tick - lastDebounceTick) > DEBOUNCE_DELAY)
    {
        lastDebounceTick = tick;

        // Stop current DMA
        __HAL_TIM_DISABLE_DMA(&htim2, TIM_DMA_CC1);
        HAL_DMA_Abort_IT(&hdma_tim2_ch1);

        // Move to next waveform
        currentWave = (currentWave + 1) % WAVE_COUNT;

      HAL_DMA_Start_IT(&hdma_tim2_ch1,(uint32_t)waveforms[currentWave],DestAddress, NS);

        __HAL_TIM_ENABLE_DMA(&htim2, TIM_DMA_CC1);
        HAL_GPIO_WritePin(GPIOA, GPIO_PIN_5, GPIO_PIN_SET);
        // Update LCD
        lcd_command(CLEAR);
        lcd_command(CURSOR_HOME);
        lcd_putstring("Waveform:");
        lcd_command(LINE_TWO);
        lcd_putstring((char*)waveNames[currentWave]);
    }
}
/* USER CODE END 4 */

/**
  * @brief  This function is executed in case of error occurrence.
  * @retval None
  */
void Error_Handler(void)
{
  /* USER CODE BEGIN Error_Handler_Debug */
  /* User can add his own implementation to report the HAL error return state */
  __disable_irq();
  while (1)
  {
  }
  /* USER CODE END Error_Handler_Debug */
}
#ifdef USE_FULL_ASSERT
/**
  * @brief  Reports the name of the source file and the source line number
  *         where the assert_param error has occurred.
  * @param  file: pointer to the source file name
  * @param  line: assert_param error line source number
  * @retval None
  */
void assert_failed(uint8_t *file, uint32_t line)
{
  /* USER CODE BEGIN 6 */
  /* User can add his own implementation to report the file name and line number,
     ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */
  /* USER CODE END 6 */
}
#endif /* USE_FULL_ASSERT */
